#!/usr/bin/env sloth

let remote = 'https://github.com/retroenv/retrodisasm.git'
let localPath = './THIRD_PARTY/disassembler'
let binary = File("${localPath}/retrodisasm")

if $argv.length != 1 {
  throw "Usage: ./disassemble $ROM"
}

let input = $argv[0]

with ($cwd = $scriptDir) {
  if not binary.exists() {
    let localRepo = Directory(localPath)
    if not localRepo.exists() {
      ['git', 'clone', remote,
        '-b', 'v0.3.0',
        localPath]!
    }
    with ($cwd = localRepo.path) {
      'go build .'!
    }
  }

  [binary.path, input]!
}
